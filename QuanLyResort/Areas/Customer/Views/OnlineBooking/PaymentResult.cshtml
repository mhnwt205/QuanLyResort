@model QuanLyResort.ViewModels.PaymentResultViewModel
@{
    Layout = "~/Areas/Customer/Views/Shared/_CustomerLayout.cshtml";
    ViewData["Title"] = "K·∫øt qu·∫£ thanh to√°n";
    var hasSuccess = TempData["SuccessMessage"] != null || Model.IsSuccess || !string.IsNullOrEmpty(Model.BookingCode);
}

<style>
    .result-container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
    }
    .result-card {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        text-align: center;
    }
    .success-icon {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #4CAF50, #8BC34A);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 30px;
        font-size: 50px;
        color: white;
    }
    .error-icon {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #f44336, #ff9800);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 30px;
        font-size: 50px;
        color: white;
    }
    .booking-details {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 30px;
        margin: 30px 0;
    }
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #e9ecef;
    }
    .detail-row:last-child {
        border-bottom: none;
    }
    .detail-label {
        font-weight: 600;
        color: #495057;
    }
    .detail-value {
        color: #6c757d;
    }
    .btn-action {
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
        display: inline-block;
        margin: 10px;
        transition: all 0.3s ease;
    }
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
    }
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        color: white;
    }
    .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
    }
    .btn-secondary:hover {
        background: #5a6268;
        color: white;
    }
    .payment-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin: 30px 0;
    }
</style>

<div class="result-container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <strong>@TempData["SuccessMessage"]</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong>@TempData["ErrorMessage"]</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    
    <div class="result-card">
        @{
            var isReallySuccess = Model.IsSuccess || 
                                  TempData["SuccessMessage"] != null ||
                                  Model.PaymentMethod == "cash" ||
                                  !string.IsNullOrEmpty(Model.BookingCode);
        }
        
        @if (isReallySuccess)
        {
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            <h1 class="text-success mb-3">üéâ ƒê·∫∑t ph√≤ng th√†nh c√¥ng!</h1>
            
            @if (!string.IsNullOrEmpty(Model.Message))
            {
                <p class="lead text-success mb-4"><strong>@Model.Message</strong></p>
            }
            else
            {
                <p class="lead text-success mb-4"><strong>C·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t ph√≤ng t·∫°i Resort Deluxe!</strong></p>
            }
            
            <p class="text-success">
                <i class="fas fa-check-circle me-2"></i>
                ƒê·∫∑t ph√≤ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n th√†nh c√¥ng!
            </p>
            
            @if (Model.PaymentMethod == "cash")
            {
                <p class="text-info">
                    <i class="fas fa-envelope me-2"></i>
                    Vui l√≤ng ki·ªÉm tra email ƒë·ªÉ bi·∫øt h∆∞·ªõng d·∫´n thanh to√°n c·ªçc.
                </p>
            }
            else if (Model.PaymentMethod == "momo")
            {
                <p class="text-info">
                    <i class="fas fa-mobile-alt me-2"></i>
                    Thanh to√°n MoMo c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω.
                </p>
            }
        }
        else
        {
            <div class="error-icon">
                <i class="fas fa-clock"></i>
            </div>
            <h1 class="text-warning mb-3">ƒêang ch·ªù thanh to√°n</h1>
            <p class="lead text-muted mb-4">@Model.Message</p>
        }

        <!-- Booking Details -->
        <div class="booking-details">
            <h4 class="mb-4"><i class="fas fa-info-circle me-2"></i>Th√¥ng tin ƒë·∫∑t ph√≤ng</h4>
            <div class="detail-row">
                <span class="detail-label">M√£ ƒë·∫∑t ph√≤ng:</span>
                <span class="detail-value"><strong>@Model.BookingCode</strong></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Ph√≤ng:</span>
                <span class="detail-value">@Model.RoomName</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Ng√†y nh·∫≠n ph√≤ng:</span>
                <span class="detail-value">@Model.CheckInDate.ToString("dd/MM/yyyy")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Ng√†y tr·∫£ ph√≤ng:</span>
                <span class="detail-value">@Model.CheckOutDate.ToString("dd/MM/yyyy")</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Ng√†y ƒë·∫∑t:</span>
                <span class="detail-value">@Model.BookingDate.ToString("dd/MM/yyyy HH:mm")</span>
            </div>
        </div>

        <!-- Payment Information -->
        <div class="payment-info">
            <h4 class="mb-4"><i class="fas fa-credit-card me-2"></i>Th√¥ng tin thanh to√°n</h4>
            <div class="detail-row">
                <span class="detail-label">Ph∆∞∆°ng th·ª©c:</span>
                <span class="detail-value">
                    @if (Model.PaymentMethod == "momo")
                    {
                        <i class="fas fa-mobile-alt me-2"></i>@("MoMo")
                    }
                    else
                    {
                        <i class="fas fa-money-bill-wave me-2"></i>@("Ti·ªÅn m·∫∑t")
                    }
                </span>
            </div>
            <div class="detail-row">
                <span class="detail-label">S·ªë ti·ªÅn:</span>
                <span class="detail-value"><strong>@Model.Amount.ToString("N0") VNƒê</strong></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Tr·∫°ng th√°i:</span>
                <span class="detail-value">
                    @if (Model.IsSuccess)
                    {
                        <span class="badge bg-success">ƒê√£ thanh to√°n</span>
                    }
                    else
                    {
                        <span class="badge bg-warning">Ch·ªù thanh to√°n</span>
                    }
                </span>
            </div>
        </div>

        @if (!Model.IsSuccess && Model.PaymentMethod == "cash")
        {
            <div class="alert alert-info">
                <h5><i class="fas fa-info-circle me-2"></i>H∆∞·ªõng d·∫´n thanh to√°n c·ªçc</h5>
                <p class="mb-3">Vui l√≤ng chuy·ªÉn kho·∫£n <strong>@Model.Amount.ToString("N0") VNƒê</strong> ƒë·ªÉ c·ªçc ph√≤ng trong v√≤ng 24h.</p>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Th√¥ng tin chuy·ªÉn kho·∫£n:</strong>
                        <ul class="list-unstyled mt-2">
                            <li><i class="fas fa-university me-2"></i>Ng√¢n h√†ng: Vietcombank</li>
                            <li><i class="fas fa-credit-card me-2"></i>STK: 1234567890</li>
                            <li><i class="fas fa-user me-2"></i>Ch·ªß TK: KHACH SAN DELUXE</li>
                            <li><i class="fas fa-comment me-2"></i>N·ªôi dung: @Model.BookingCode</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <strong>L∆∞u √Ω:</strong>
                        <ul class="list-unstyled mt-2">
                            <li><i class="fas fa-clock me-2"></i>Chuy·ªÉn kho·∫£n trong 24h</li>
                            <li><i class="fas fa-phone me-2"></i>Li√™n h·ªá: 0123456789</li>
                            <li><i class="fas fa-envelope me-2"></i>Email: info@deluxeresort.vn</li>
                        </ul>
                    </div>
                </div>
            </div>
        }

        <!-- Action Buttons -->
        <div class="mt-4">
            @if (Model.IsSuccess)
            {
                <a href="/Customer" class="btn-action btn-primary">
                    <i class="fas fa-home me-2"></i>V·ªÅ trang ch·ªß
                </a>
                <a href="@Url.Action("Index", "BookingHistory", new { area = "Customer" })" class="btn-action btn-success">
                    <i class="fas fa-history me-2"></i>Xem l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng
                </a>
                <a href="/Customer/Rooms" class="btn-action btn-secondary">
                    <i class="fas fa-bed me-2"></i>Xem th√™m ph√≤ng
                </a>
            }
            else
            {
                <a href="/Customer" class="btn-action btn-primary">
                    <i class="fas fa-home me-2"></i>V·ªÅ trang ch·ªß
                </a>
                <a href="@Url.Action("Index", "BookingHistory", new { area = "Customer" })" class="btn-action btn-info">
                    <i class="fas fa-history me-2"></i>Xem l·ªãch s·ª≠ ƒë·∫∑t ph√≤ng
                </a>
                <a href="/Customer/Rooms" class="btn-action btn-secondary">
                    <i class="fas fa-bed me-2"></i>ƒê·∫∑t ph√≤ng kh√°c
                </a>
            }
        </div>

        @* Hi·ªÉn th·ªã th√¥ng tin chuy·ªÉn kho·∫£n cho thanh to√°n ti·ªÅn m·∫∑t *@
        @if (Model.PaymentMethod == "cash" && (Model.IsSuccess || isReallySuccess))
        {
            <div class="alert alert-warning mt-4" style="border-left: 4px solid #ffc107;">
                <h5 class="alert-heading"><i class="fas fa-university me-2"></i>Th√¥ng tin chuy·ªÉn kho·∫£n</h5>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>üè¶ Ng√¢n h√†ng:</strong> Vietcombank</p>
                        <p class="mb-2"><strong>üí≥ S·ªë t√†i kho·∫£n:</strong> <span class="text-primary fw-bold">1234567890</span></p>
                        <p class="mb-2"><strong>üë§ Ch·ªß TK:</strong> KHACH SAN RESORT DELUXE</p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-2"><strong>üìù N·ªôi dung CK:</strong> <span class="text-danger fw-bold">@Model.BookingCode</span></p>
                        <p class="mb-2"><strong>üíµ S·ªë ti·ªÅn c·ªçc:</strong> <span class="text-success fw-bold">@Model.Amount.ToString("N0") VNƒê</span></p>
                    </div>
                </div>
                <hr>
                <p class="mb-0 text-danger"><i class="fas fa-exclamation-triangle me-2"></i><strong>L∆∞u √Ω:</strong> Vui l√≤ng chuy·ªÉn kho·∫£n trong v√≤ng 24h ƒë·ªÉ gi·ªØ ph√≤ng.</p>
            </div>
        }
        
        @if (!Model.IsSuccess && Model.PaymentMethod != "cash")
        {
            <div class="mt-4">
                <p class="text-muted">
                    <i class="fas fa-envelope me-2"></i>
                    Ch√∫ng t√¥i ƒë√£ g·ª≠i th√¥ng tin chi ti·∫øt ƒë·∫øn email c·ªßa b·∫°n. 
                    Vui l√≤ng ki·ªÉm tra h·ªôp th∆∞ v√† l√†m theo h∆∞·ªõng d·∫´n.
                </p>
            </div>
        }
    </div>
</div>

@if (hasSuccess)
{
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Show success notification v·ªõi SweetAlert2
        window.addEventListener('DOMContentLoaded', function() {
            Swal.fire({
                icon: 'success',
                title: 'üéâ ƒê·∫∑t ph√≤ng th√†nh c√¥ng!',
                html: '<strong>M√£ ƒë·∫∑t ph√≤ng:</strong> @Model.BookingCode<br>' +
                      '@(Model.PaymentMethod == "cash" ? "Vui l√≤ng ki·ªÉm tra email ƒë·ªÉ bi·∫øt h∆∞·ªõng d·∫´n thanh to√°n c·ªçc." : "Thanh to√°n c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω.")',
                showConfirmButton: true,
                confirmButtonText: 'Tuy·ªát v·ªùi!',
                confirmButtonColor: '#667eea',
                timer: 5000,
                timerProgressBar: true
            });
        });
    </script>
}
